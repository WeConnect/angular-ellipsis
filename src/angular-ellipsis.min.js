angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window",function(e,t){return{restrict:"A",scope:{ngBind:"=",ellipsisId:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@"},compile:function(n,r,i){return function(n,r,i){function s(){if(typeof n.ngBind!=="undefined"){var e=n.ngBind.split(" "),t=0,s=typeof i.ellipsisSymbol!=="undefined"?i.ellipsisSymbol:"&hellip;",u=typeof n.ellipsisAppend!=="undefined"&&n.ellipsisAppend!==""?s+"<span>"+n.ellipsisAppend+"</span>":s;i.isTruncated=false;r.html(n.ngBind);if(o(r)){var a=e.length,f=r[0].clientHeight;r.html(n.ngBind+u);for(;t<a;t++){e.pop();r.html(e.join(" ")+u);if(r[0].scrollHeight<f||o(r)===false){i.isTruncated=true;break}}if(s!=u&&typeof n.ellipsisAppendClick!=="undefined"&&n.ellipsisAppendClick!==""){r.find("span").bind("click",function(e){n.$apply(n.ellipsisAppendClick)})}}}}function o(e){return e[0].scrollHeight>e[0].clientHeight}i.lastWindowResizeTime=0;i.lastWindowResizeWidth=0;i.lastWindowResizeHeight=0;i.lastWindowTimeoutEvent=null;i.isTruncated=false;if(n.ellipsisId!==null&&n.ellipsisId!==""){n.$on("ellipsize-"+n.ellipsisId,function(){i.lastWindowTimeoutEvent=e(function(){s()},75)})}n.$watch("ngBind",function(){s()});n.$watch("ellipsisAppend",function(){s()});angular.element(t).bind("resize",function(){e.cancel(i.lastWindowTimeoutEvent);i.lastWindowTimeoutEvent=e(function(){if(i.lastWindowResizeWidth!=window.innerWidth||i.lastWindowResizeHeight!=window.innerHeight){s()}i.lastWindowResizeWidth=window.innerWidth;i.lastWindowResizeHeight=window.innerHeight},75)})}}}}])
